<!DOCTYPE html>
<html>
<head>
<link rel="manifest" href="/manifest.json">
<script>
if ('serviceWorker' in navigator) { navigator.serviceWorker.register('/service-worker.js'); }
</script>
<title>Gateway Leasing - Dealer Appraisal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
<style>
body { font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif; background:#f2f3f5; margin:0; padding:0; }
header { display:flex; align-items:center; justify-content:center; background:white; padding:10px; box-shadow:0 2px 4px rgba(0,0,0,0.1); position:sticky; top:0; }
header img { height:32px; margin-right:10px; }
.container { padding:20px; max-width:500px; margin:auto; }
.card { background:white; border-radius:20px; padding:20px; margin-bottom:20px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
input[type=text], input[type=email], input[type=file] {
  width: 95%; padding:14px; margin:8px 0; border-radius:12px; border:1px solid #ccc; font-size:16px;
}
button {
  width: 100%; padding:16px; margin-top:10px;
  border-radius:12px; border:none;
  background:linear-gradient(145deg,#A8D5BA,#d7f2e1);
  font-weight:700; font-size:18px;
  cursor:pointer;
}
button:hover { opacity:0.9; }
.toggle { position: relative; display: inline-block; width: 50px; height: 28px; }
.toggle input { display:none; }
.slider {
  position: absolute; cursor: pointer; top:0; left:0; right:0; bottom:0;
  background-color: #ccc; transition: .4s; border-radius: 28px;
}
.slider:before {
  position: absolute; content: ""; height: 22px; width: 22px; left:3px; bottom:3px;
  background:white; transition:.4s; border-radius:50%;
}
input:checked + .slider { background-color: #A8D5BA; }
input:checked + .slider:before { transform: translateX(22px); }
.photo-preview { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
.photo-preview div { position:relative; }
.photo-preview img { width:70px; height:70px; object-fit:cover; border-radius:10px; }
.photo-preview button {
  position:absolute; top:-6px; right:-6px; background:red; color:white; border:none;
  border-radius:50%; width:20px; height:20px; font-size:12px; cursor:pointer;
}
#scanner-container { width:100%; max-width:350px; margin:auto; display:none; border-radius:12px; overflow:hidden; }
video { width:100%; border-radius:12px; }
</style>
<script>
function startScanner() {
  document.getElementById('scanner-container').style.display = 'block';
  Quagga.init({
    inputStream: { name: "Live", type: "LiveStream", target: document.querySelector('#scanner-container') },
    decoder: { readers: ["code128_reader","code39_reader"] }
  }, function(err) {
    if (err) { console.error(err); return; }
    Quagga.start();
  });
  Quagga.onDetected(function(data){
    document.getElementById('vin').value = data.codeResult.code;
    Quagga.stop();
    document.getElementById('scanner-container').style.display = 'none';
    alert("VIN detected: " + data.codeResult.code);
  });
}

function previewPhotos(event) {
  const files = event.target.files;
  const preview = document.getElementById('preview');
  preview.innerHTML = "";
  for (let i=0; i<files.length; i++) {
    const file = files[i];
    const reader = new FileReader();
    reader.onload = function(e) {
      const div = document.createElement('div');
      div.innerHTML = '<img src="'+e.target.result+'"><button type="button" onclick="removePhoto(this)">Ã—</button>';
      preview.appendChild(div);
    }
    reader.readAsDataURL(file);
  }
}
function removePhoto(btn){
  btn.parentElement.remove();
}
</script>
</head>
<body>
<header>
  <img src="/static/gateway_logo.png" alt="Gateway Logo">
  <h2>Vehicle Appraisal</h2>
</header>
<div class="container">
<form method="POST" action="/submit" enctype="multipart/form-data">
  <div class="card">
    <h3>Step 1: Vehicle Info</h3>
    <input type="text" id="vin" name="vin" placeholder="Enter or Scan VIN" required>
    <button type="button" onclick="startScanner()">ðŸ“· Scan VIN</button>
    <div id="scanner-container"><video autoplay="true"></video></div>
    <input type="text" name="kms" placeholder="Kilometers" required>
    <input type="email" name="email" placeholder="Your Email (for copy)">
  </div>

  <div class="card">
    <h3>Step 2: Photos</h3>
    <input type="file" name="photos" accept="image/*" multiple onchange="previewPhotos(event)">
    <div id="preview" class="photo-preview"></div>
  </div>

  <div class="card">
    <h3>Step 3: Submit</h3>
    <label>Send me a copy</label>
    <label class="toggle">
      <input type="checkbox" name="send_copy" checked>
      <span class="slider"></span>
    </label>
    <button type="submit">ðŸš€ Submit Appraisal</button>
  </div>
</form>
</div>
</body>
</html>
